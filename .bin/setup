#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
source $DIR/shared

echo "Let's get this party started! ğŸ‰ Starting up the Docker container... ğŸ•"
echo "ğŸ§¹ Cleaning up old containers... ğŸ§½"
docker-compose down
docker-compose up --build -d

echo "â³ Waiting for the container to warm up... â³"
RETRIES=0
MAX_RETRIES=30
until curl --silent --fail http://localhost:4173; do
  if (( RETRIES == MAX_RETRIES )); then
    echo "ğŸš¨ Timeout reached! The app is not responding. Please check the logs."
    exit 1
  fi
  (( RETRIES++ ))
  echo "ğŸ’¤ Waiting for app to be responsive... Attempt $RETRIES/$MAX_RETRIES"
  sleep 2
done

echo "Opening your browser... ğŸ»"
if command -v xdg-open &> /dev/null
then
  echo "Opening in the default browser... ğŸ˜"
  xdg-open http://localhost:4173
elif command -v open &> /dev/null
then
  echo "Opening in the default browser... ğŸ˜"
  open http://localhost:4173
else
  echo "Oops! Could not detect the default browser. ğŸ¤·â€â™‚ï¸"
fi

echo "ğŸ’° Daniel's frontend challenge submission is now live and thriving! ğŸŒŸ"
